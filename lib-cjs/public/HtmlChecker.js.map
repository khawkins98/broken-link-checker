{"version":3,"file":"HtmlChecker.js","names":["_events","require","_Link","_linkTypes","_parseHTML","_interopRequireDefault","_parseOptions","_robotDirectives","_interopRequireWildcard","_SafeEventEmitter","_scrapeHTML","_httpProtocol","_UrlChecker","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","obj","_classPrivateMethodInitSpec","privateSet","_checkPrivateRedeclaration","add","_classPrivateFieldInitSpec","privateMap","value","privateCollection","TypeError","_classPrivateFieldGet","receiver","descriptor","_classExtractFieldDescriptor","_classApplyDescriptorGet","_classPrivateMethodGet","fn","_classPrivateFieldSet","_classApplyDescriptorSet","action","writable","_auth","_excludedLinks","_options","_resolvePromise","_robots","_scanning","_urlChecker","_complete","WeakSet","_getExcludeReason","_isExcludedAttribute","_maybeEnqueueLink","_reset","HtmlChecker","SafeEventEmitter","constructor","options","parseOptions","_reset2","UrlChecker","on","ERROR_EVENT","error","emit","QUEUE_EVENT","JUNK_EVENT","result","_this$excludedLinks","_this$excludedLinks2","HTML_OFFSET_INDEX","LINK_EVENT","END_EVENT","_complete2","clearCache","isPaused","numActiveLinks","numQueuedLinks","pause","resume","scan","html","baseURL","robots","auth","Error","RobotDirectives","userAgent","transitive","transitiveAuth","url","document","parseHTML","links","scrapeHTML","HTML_EVENT","forEach","link","_maybeEnqueueLink2","resolveOnComplete","Promise","resolve","__cache","exports","resolvePromise","COMPLETE_EVENT","_getExcludeReason2","attrName","HTML_ATTR_NAME","attrs","HTML_ATTRS","isInternal","IS_INTERNAL","tagName","HTML_TAG_NAME","excludeExternalLinks","excludeInternalLinks","excludeLinksToSamePage","honorRobotExclusions","oneIs","NOFOLLOW","NOINDEX","is","NOIMAGEINDEX","isRobotAttr","rel","linkTypes","nofollow","_isExcludedAttribute2","IS_SAME_PAGE","tagNames","tagGroups","tags","filterLevel","every","REBASED_URL","HTML_INDEX","break","excludedReason","undefined","enqueue","_this$excludedLinks3","_this$excludedLinks4","exclude","module"],"sources":["../../lib/public/HtmlChecker.js"],"sourcesContent":["import {COMPLETE_EVENT, END_EVENT, ERROR_EVENT, HTML_EVENT, JUNK_EVENT, LINK_EVENT, QUEUE_EVENT} from \"../internal/events\";\nimport {HTML_ATTR_NAME, HTML_ATTRS, HTML_INDEX, HTML_OFFSET_INDEX, HTML_TAG_NAME, IS_INTERNAL, IS_SAME_PAGE, REBASED_URL} from \"../internal/Link\";\nimport {map as linkTypes} from \"link-types\";\nimport parseHTML from \"../internal/parseHTML\";\nimport parseOptions from \"../internal/parseOptions\";\nimport RobotDirectives, {NOFOLLOW, NOIMAGEINDEX, NOINDEX} from \"robot-directives\";\nimport SafeEventEmitter from \"../internal/SafeEventEmitter\";\nimport scrapeHTML from \"../internal/scrapeHTML\";\nimport {transitiveAuth} from \"../internal/http-protocol\";\nimport UrlChecker from \"./UrlChecker\";\n\n\n\nexport default class HtmlChecker extends SafeEventEmitter\n{\n\t#auth;\n\t#excludedLinks;\n\t#options;\n\t#resolvePromise;\n\t#robots;\n\t#scanning;\n\t#urlChecker;\n\n\n\n\tconstructor(options)\n\t{\n\t\tsuper();\n\t\tthis.#options = parseOptions(options);\n\t\tthis.#reset();\n\n\t\tthis.#urlChecker = new UrlChecker(this.#options)\n\t\t.on(ERROR_EVENT, error => this.emit(ERROR_EVENT, error))\n\t\t.on(QUEUE_EVENT, () => this.emit(QUEUE_EVENT))\n\t\t.on(JUNK_EVENT, result =>\n\t\t{\n\t\t\tresult.set(HTML_OFFSET_INDEX, this.#excludedLinks++);\n\n\t\t\tthis.emit(JUNK_EVENT, result);\n\t\t})\n\t\t.on(LINK_EVENT, result => this.emit(LINK_EVENT, result))\n\t\t.on(END_EVENT, () => this.#complete());\n\t}\n\n\n\n\tclearCache()\n\t{\n\t\tthis.#urlChecker.clearCache();\n\t\treturn this;\n\t}\n\n\n\n\t#complete()\n\t{\n\t\tconst resolvePromise = this.#resolvePromise;\n\n\t\tthis.#reset();\n\n\t\tthis.emit(COMPLETE_EVENT);\n\n\t\tresolvePromise();\n\t}\n\n\n\n\t/**\n\t * Determine whether a Link should be excluded from checks, and the reason for such.\n\t * @param {Link} link\n\t * @returns {string|undefined}\n\t */\n\t#getExcludeReason(link)\n\t{\n\t\tconst attrName = link.get(HTML_ATTR_NAME);\n\t\tconst attrs = link.get(HTML_ATTRS);\n\t\tconst isInternal = link.get(IS_INTERNAL);\n\t\tconst tagName = link.get(HTML_TAG_NAME);\n\n\t\tconst\n\t\t{\n\t\t\texcludeExternalLinks,\n\t\t\texcludeInternalLinks,\n\t\t\texcludeLinksToSamePage,\n\t\t\thonorRobotExclusions\n\t\t} = this.#options;\n\n\t\tif (honorRobotExclusions && this.#robots.oneIs([ NOFOLLOW, NOINDEX ]))\n\t\t{\n\t\t\treturn \"BLC_ROBOTS\";\n\t\t}\n\t\telse if (honorRobotExclusions && this.#robots.is(NOIMAGEINDEX) && isRobotAttr(tagName, attrName))\n\t\t{\n\t\t\treturn \"BLC_ROBOTS\";\n\t\t}\n\t\telse if (honorRobotExclusions && attrs?.rel!=null && linkTypes(attrs.rel).nofollow)\n\t\t{\n\t\t\treturn \"BLC_ROBOTS\";\n\t\t}\n\t\telse if (this.#isExcludedAttribute(attrName, [tagName, \"*\"]))\n\t\t{\n\t\t\treturn \"BLC_HTML\";\n\t\t}\n\t\telse if (excludeExternalLinks && isInternal===false)\n\t\t{\n\t\t\treturn \"BLC_EXTERNAL\";\n\t\t}\n\t\telse if (excludeInternalLinks && isInternal)\n\t\t{\n\t\t\treturn \"BLC_INTERNAL\";\n\t\t}\n\t\telse if (excludeLinksToSamePage && link.get(IS_SAME_PAGE))\n\t\t{\n\t\t\treturn \"BLC_SAMEPAGE\";\n\t\t}\n\t}\n\n\n\n\t/**\n\t * Determine whether a Link's HTML element and attribute would cause it to be excluded from checks.\n\t * @param {string} attrName\n\t * @param {Array<string>} tagNames\n\t * @returns {boolean}\n\t */\n\t#isExcludedAttribute(attrName, tagNames)\n\t{\n\t\tconst tagGroups = this.#options.tags[this.#options.filterLevel];\n\n\t\treturn tagNames.every(tagName => !(tagName in tagGroups) || !(attrName in tagGroups[tagName]));\n\t}\n\n\n\n\tget isPaused()\n\t{\n\t\treturn this.#urlChecker.isPaused;\n\t}\n\n\n\n\t/**\n\t * Enqueue a Link if it is valid and passes filters.\n\t * @param {Link} link\n\t */\n\t#maybeEnqueueLink(link)\n\t{\n\t\tif (link.get(REBASED_URL) === null)\n\t\t{\n\t\t\tlink.set(HTML_OFFSET_INDEX, link.get(HTML_INDEX) - this.#excludedLinks);\n\t\t\tlink.break(\"BLC_INVALID\");\n\n\t\t\t// Can't enqueue a non-URL\n\t\t\tthis.emit(LINK_EVENT, link);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst excludedReason = this.#getExcludeReason(link);\n\n\t\t\tif (excludedReason === undefined)\n\t\t\t{\n\t\t\t\tlink.set(HTML_OFFSET_INDEX, link.get(HTML_INDEX) - this.#excludedLinks);\n\n\t\t\t\tthis.#urlChecker.enqueue(link, null, this.#auth);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlink.set(HTML_OFFSET_INDEX, this.#excludedLinks++);\n\t\t\t\tlink.exclude(excludedReason);\n\n\t\t\t\tthis.emit(JUNK_EVENT, link);\n\t\t\t}\n\t\t}\n\t}\n\n\n\n\tget numActiveLinks()\n\t{\n\t\treturn this.#urlChecker.numActiveLinks;\n\t}\n\n\n\n\tget numQueuedLinks()\n\t{\n\t\treturn this.#urlChecker.numQueuedLinks;\n\t}\n\n\n\n\tpause()\n\t{\n\t\tthis.#urlChecker.pause();\n\t\treturn this;\n\t}\n\n\n\n\t#reset()\n\t{\n\t\tthis.#auth = null;\n\t\tthis.#excludedLinks = 0;\n\t\tthis.#resolvePromise = null;\n\t\tthis.#robots = null;\n\t\tthis.#scanning = false;\n\t}\n\n\n\n\tresume()\n\t{\n\t\tthis.#urlChecker.resume();\n\t\treturn this;\n\t}\n\n\n\n\t// `robots` and `auth` are undocumented and for internal use only\n\tasync scan(html, baseURL, robots, auth)\n\t{\n\t\tif (this.#scanning)\n\t\t{\n\t\t\t// @todo use custom error (for better tests and consumer debugging) ?\n\t\t\tthrow new Error(\"Scan already in progress\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// Prevent user error with missing undocumented arugment\n\t\t\tif (!(robots instanceof RobotDirectives))\n\t\t\t{\n\t\t\t\trobots = new RobotDirectives({ userAgent: this.#options.userAgent });\n\t\t\t}\n\n\t\t\tconst transitive = transitiveAuth(baseURL, auth);\n\n\t\t\tbaseURL = transitive.url;  // @todo remove hash (and store somewhere?)\n\n\t\t\tthis.#auth = transitive.auth;\n\t\t\tthis.#robots = robots;\n\t\t\tthis.#scanning = true;\n\n\t\t\tconst document = await parseHTML(html);\n\t\t\tconst links = scrapeHTML(document, baseURL, this.#robots);  // @todo add auth?\n\n\t\t\tthis.emit(HTML_EVENT, document, this.#robots);\n\n\t\t\tlinks.forEach(link => this.#maybeEnqueueLink(link));\n\n\t\t\tconst resolveOnComplete = new Promise(resolve => this.#resolvePromise = resolve);\n\n\t\t\t// If no links found or all links already checked\n\t\t\tif (this.#urlChecker.numActiveLinks===0 && this.#urlChecker.numQueuedLinks===0)\n\t\t\t{\n\t\t\t\tthis.#complete();\n\t\t\t}\n\n\t\t\treturn resolveOnComplete;\n\t\t}\n\t}\n\n\n\n\tget __cache()\n\t{\n\t\treturn this.#urlChecker.__cache;\n\t}\n}\n\n\n\n//::: PRIVATE FUNCTIONS\n\n\n\nconst isRobotAttr = (tagName, attrName) =>\n{\n\treturn (tagName===\"img\"      && attrName===\"src\"   ) ||\n\t       (tagName===\"input\"    && attrName===\"src\"   ) ||\n\t       (tagName===\"menuitem\" && attrName===\"icon\"  ) ||\n\t       (tagName===\"video\"    && attrName===\"poster\");\n};\n"],"mappings":"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"}