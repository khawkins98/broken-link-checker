{"version":3,"file":"SiteChecker.js","names":["_events","require","_Link","_httpProtocol","_HtmlUrlChecker","_interopRequireDefault","_parseOptions","_limitedRequestQueue","_interopRequireWildcard","_SafeEventEmitter","_urlcache","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","obj","_classPrivateMethodInitSpec","privateSet","_checkPrivateRedeclaration","add","_classPrivateFieldInitSpec","privateMap","value","privateCollection","TypeError","_classPrivateFieldGet","receiver","descriptor","_classExtractFieldDescriptor","_classApplyDescriptorGet","_classPrivateMethodGet","fn","_classPrivateFieldSet","_classApplyDescriptorSet","action","writable","PAGE_EXCLUSIONS","PAGE_WAS_CHECKED","_currentAuth","_currentCustomData","_currentDone","_currentPageError","_currentRobotsTxt","_currentSiteURL","_htmlUrlChecker","_options","_sitePagesChecked","_siteUrlQueue","_enqueuePage","WeakSet","_getExcludedReason","_isAllowed","_maybeEnqueuePage","_overrideOptions","_reset","SiteChecker","SafeEventEmitter","constructor","options","_overrideOptions2","parseOptions","URLCache","maxAge","cacheMaxAge","_reset2","RequestQueue","maxSockets","rateLimit","on","ITEM_EVENT","url","auth","customData","done","isHTTPScheme","honorRobotExclusions","robots","getRobotsTxt","__cache","emit","ROBOTS_EVENT","_enqueuePage2","REQUEST_QUEUE_END_EVENT","END_EVENT","HtmlUrlChecker","ERROR_EVENT","error","HTML_EVENT","tree","response","pageURL","redirects","forEach","redirect","QUEUE_EVENT","JUNK_EVENT","result","_maybeEnqueuePage2","LINK_EVENT","PAGE_EVENT","length","SITE_EVENT","clearCache","dequeue","id","success","enqueue","firstPageURL","transitive","transitiveAuth","isPaused","numActiveLinks","numQueuedLinks","numPages","numSites","pause","resume","exports","_getExcludedReason2","link","IS_INTERNAL","_isAllowed2","_link$get","rebasedPathname","REBASED_URL","pathname","isAllowed","userAgent","WAS_EXCLUDED","includes","EXCLUDED_REASON","tagGroup","tags","recursive","filterLevel","HTML_TAG_NAME","attrSupported","HTML_ATTR_NAME","rebasedURL","redirectedURL","REDIRECTED_URL","IS_BROKEN","HTTP_RESPONSE","includePage","includeLink","excludedReason","undefined","clear","module"],"sources":["../../lib/public/SiteChecker.js"],"sourcesContent":["import {END_EVENT, ERROR_EVENT, HTML_EVENT, JUNK_EVENT, LINK_EVENT, PAGE_EVENT, QUEUE_EVENT, ROBOTS_EVENT, SITE_EVENT} from \"../internal/events\";\nimport {EXCLUDED_REASON, HTML_ATTR_NAME, HTML_TAG_NAME, HTTP_RESPONSE, IS_BROKEN, IS_INTERNAL, REBASED_URL, REDIRECTED_URL, WAS_EXCLUDED} from \"../internal/Link\";\nimport {getRobotsTxt, isCompatibleScheme as isHTTPScheme, transitiveAuth} from \"../internal/http-protocol\";\nimport HtmlUrlChecker from \"./HtmlUrlChecker\";\nimport parseOptions from \"../internal/parseOptions\";\nimport RequestQueue, {ITEM_EVENT, END_EVENT as REQUEST_QUEUE_END_EVENT} from \"limited-request-queue\";\nimport SafeEventEmitter from \"../internal/SafeEventEmitter\";\nimport URLCache from \"urlcache\";\n\n\n\n// @todo BLC_ROBOTS catches rel=nofollow links but will also catch meta/header excluded links -- fine?\nconst PAGE_EXCLUSIONS = [\"BLC_KEYWORD\", \"BLC_ROBOTS\"];\n\nconst PAGE_WAS_CHECKED = true;\n\n\n\nexport default class SiteChecker extends SafeEventEmitter\n{\n\t#currentAuth;\n\t#currentCustomData;\n\t#currentDone;\n\t#currentPageError;\n\t#currentRobotsTxt;\n\t#currentSiteURL;\n\t#htmlUrlChecker;\n\t#options;\n\t#sitePagesChecked;\n\t#siteUrlQueue;\n\n\n\n\tconstructor(options)\n\t{\n\t\tsuper();\n\t\tthis.#options = this.#overrideOptions(parseOptions(options)); // @todo https://github.com/tc39/proposal-pipeline-operator\n\t\tthis.#sitePagesChecked = new URLCache({ maxAge: this.#options.cacheMaxAge });\n\t\tthis.#reset();\n\n\t\tthis.#siteUrlQueue = new RequestQueue(\n\t\t{\n\t\t\tmaxSockets: 1,\n\t\t\trateLimit: this.#options.rateLimit\n\t\t})\n\t\t.on(ITEM_EVENT, async (url, {auth, customData}, done) =>\n\t\t{\n\t\t\tthis.#reset();\n\n\t\t\tthis.#currentAuth = auth;\n\t\t\tthis.#currentCustomData = customData;\n\t\t\tthis.#currentDone = done;\n\t\t\tthis.#currentSiteURL = url;  // @todo strip after hostname?\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tif (isHTTPScheme(url) && this.#options.honorRobotExclusions)\n\t\t\t\t{\n\t\t\t\t\tconst robots = await getRobotsTxt(this.#currentSiteURL, this.#currentAuth, this.__cache, this.#options);\n\n\t\t\t\t\t// This receives an instance even if no robots.txt was found\n\t\t\t\t\tthis.#currentRobotsTxt = robots;\n\n\t\t\t\t\tthis.emit(ROBOTS_EVENT, robots, this.#currentCustomData);\n\t\t\t\t}\n\t\t\t}\n\t\t\tcatch\n\t\t\t{\n\t\t\t\t// If could not connect to server -- let `HtmlUrlChecker` catch it\n\t\t\t}\n\t\t\tfinally\n\t\t\t{\n\t\t\t\tthis.#enqueuePage(this.#currentSiteURL, this.#currentCustomData, this.#currentAuth);\n\t\t\t}\n\t\t})\n\t\t.on(REQUEST_QUEUE_END_EVENT, () =>\n\t\t{\n\t\t\t// Clear references for garbage collection\n\t\t\tthis.#reset();\n\n\t\t\tthis.emit(END_EVENT);\n\t\t});\n\n\t\tthis.#htmlUrlChecker = new HtmlUrlChecker(this.#options)\n\t\t.on(ERROR_EVENT, error => this.emit(ERROR_EVENT, error))\n\t\t.on(HTML_EVENT, (tree, robots, response, pageURL, customData) =>\n\t\t{\n\t\t\t// If was redirected\n\t\t\tif (response.url !== pageURL)\n\t\t\t{\n\t\t\t\tthis.#sitePagesChecked.set(response.url, PAGE_WAS_CHECKED);\n\n\t\t\t\t// Avoid rechecking any redirected pages\n\t\t\t\tresponse.redirects.forEach(redirect => this.#sitePagesChecked.set(redirect.url, PAGE_WAS_CHECKED));\n\t\t\t}\n\n\t\t\tthis.emit(HTML_EVENT, tree, robots, response, pageURL, customData);\n\t\t})\n\t\t.on(QUEUE_EVENT, () => this.emit(QUEUE_EVENT))\n\t\t.on(JUNK_EVENT, (result, customData) =>\n\t\t{\n\t\t\tthis.emit(JUNK_EVENT, result, customData);\n\n\t\t\tthis.#maybeEnqueuePage(result, customData, this.#currentAuth);\n\t\t})\n\t\t.on(LINK_EVENT, (result, customData) =>\n\t\t{\n\t\t\tthis.emit(LINK_EVENT, result, customData);\n\n\t\t\tthis.#maybeEnqueuePage(result, customData, this.#currentAuth);\n\t\t})\n\t\t.on(PAGE_EVENT, (error, pageURL, customData) =>\n\t\t{\n\t\t\tthis.emit(PAGE_EVENT, error, pageURL, customData);\n\n\t\t\t// Only the first page should supply an error to SITE_EVENT\n\t\t\tif (this.#sitePagesChecked.length <= 1)\n\t\t\t{\n\t\t\t\tthis.#currentPageError = error;\n\t\t\t}\n\t\t})\n\t\t.on(END_EVENT, () =>\n\t\t{\n\t\t\tthis.emit(SITE_EVENT, this.#currentPageError, this.#currentSiteURL, this.#currentCustomData);\n\n\t\t\t// Auto-starts next site, if any\n\t\t\t// Emits REQUEST_QUEUE_END_EVENT, if not\n\t\t\tthis.#currentDone();\n\t\t});\n\t}\n\n\n\n\tclearCache()\n\t{\n\t\t// Does not clear `sitePagesChecked` because it would mess up any current scans\n\t\tthis.#htmlUrlChecker.clearCache();\n\t\treturn this;\n\t}\n\n\n\n\tdequeue(id)\n\t{\n\t\tconst success = this.#siteUrlQueue.dequeue(id);\n\n\t\tthis.emit(QUEUE_EVENT);\n\n\t\treturn success;\n\t}\n\n\n\n\tenqueue(firstPageURL, customData)\n\t{\n\t\tconst transitive = transitiveAuth(firstPageURL);\n\n\t\tconst success = this.#siteUrlQueue.enqueue(transitive.url, { auth:transitive.auth, customData });\n\n\t\tthis.emit(QUEUE_EVENT);\n\n\t\treturn success;\n\t}\n\n\n\n\t/**\n\t * Enqueue a URL to be crawled.\n\t * @param {URL} url\n\t * @param {*} customData\n\t * @param {object} auth\n\t */\n\t#enqueuePage(url, customData, auth)\n\t{\n\t\t// Avoid links to self within page\n\t\tthis.#sitePagesChecked.set(url, PAGE_WAS_CHECKED);\n\n\t\tthis.#htmlUrlChecker.enqueue(url, customData, auth);\n\t}\n\n\n\n\t/**\n\t * Determine whether a Link should be excluded from checks, and the reason for such.\n\t * @param {Link} link\n\t * @returns {string|undefined}\n\t */\n\t#getExcludedReason(link)\n\t{\n\t\tif (link.get(IS_INTERNAL) && !this.#isAllowed(link))\n\t\t{\n\t\t\treturn \"BLC_ROBOTS\";\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// Not excluded\n\t\t}\n\t}\n\n\n\n\thas(id)\n\t{\n\t\treturn this.#siteUrlQueue.has(id);\n\t}\n\n\n\n\t/**\n\t * Determine whether a Link should be included, conforming to any robots filter.\n\t * @param {Link} link\n\t * @returns {boolean}\n\t */\n\t#isAllowed(link)\n\t{\n\t\tif (this.#options.honorRobotExclusions)\n\t\t{\n\t\t\tconst rebasedPathname = link.get(REBASED_URL)?.pathname;\n\n\t\t\t// @todo remove condition when/if `Link::invalidate()` is used in `HtmlChecker`\n\t\t\tif (rebasedPathname !== null)\n\t\t\t{\n\t\t\t\treturn this.#currentRobotsTxt.isAllowed(this.#options.userAgent, rebasedPathname);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn true;\n\t\t}\n\t}\n\n\n\n\tget isPaused()\n\t{\n\t\treturn this.#htmlUrlChecker.isPaused;\n\t}\n\n\n\n\t/**\n\t * Enqueue a page (to be crawled) if it passes filters.\n\t * @param {Link} link\n\t * @param {*} customData\n\t * @param {object} auth\n\t */\n\t#maybeEnqueuePage(link, customData, auth)\n\t{\n\t\t// Skip specific links that were excluded from checks\n\t\tif (link.get(WAS_EXCLUDED) && PAGE_EXCLUSIONS.includes(link.get(EXCLUDED_REASON)))\n\t\t{\n\t\t\t// do nothing\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst tagGroup = this.#options.tags.recursive[this.#options.filterLevel][link.get(HTML_TAG_NAME)] ?? {};\n\t\t\tconst attrSupported = link.get(HTML_ATTR_NAME) in tagGroup;\n\t\t\tconst rebasedURL = link.get(REBASED_URL);\n\t\t\tconst redirectedURL = link.get(REDIRECTED_URL);\n\n\t\t\tif (\n\t\t\t\t!attrSupported ||\n\t\t\t\tlink.get(IS_BROKEN) ||\n\t\t\t\t!link.get(IS_INTERNAL) ||\n\t\t\t\tthis.#sitePagesChecked.has(rebasedURL) ||\n\t\t\t\t!this.#isAllowed(link)\n\t\t\t   )\n\t\t\t{\n\t\t\t\t// do nothing\n\t\t\t}\n\t\t\telse if (redirectedURL !== null)\n\t\t\t{\n\t\t\t\t// Because only the final redirected page needs to be [recursively] checked,\n\t\t\t\t// all redirects are stored as pages that have been checked\n\t\t\t\tlink.get(HTTP_RESPONSE).redirects.forEach(({url}) => this.#sitePagesChecked.set(url, PAGE_WAS_CHECKED));\n\n\t\t\t\tif (!this.#sitePagesChecked.has(redirectedURL))\n\t\t\t\t{\n\t\t\t\t\tthis.#enqueuePage(redirectedURL, customData, auth);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (this.#options.includePage(rebasedURL))\n\t\t\t{\n\t\t\t\tthis.#enqueuePage(rebasedURL, customData, auth);\n\t\t\t}\n\t\t}\n\t}\n\n\n\n\tget numActiveLinks()\n\t{\n\t\treturn this.#htmlUrlChecker.numActiveLinks;\n\t}\n\n\n\n\tget numQueuedLinks()\n\t{\n\t\treturn this.#htmlUrlChecker.numQueuedLinks;\n\t}\n\n\n\n\tget numPages()\n\t{\n\t\treturn this.#htmlUrlChecker.numPages;\n\t}\n\n\n\n\tget numSites()\n\t{\n\t\treturn this.#siteUrlQueue.length;\n\t}\n\n\n\n\t/**\n\t * Override/mutate some options for extended behavior.\n\t * @param {object} options\n\t * @returns {object}\n\t */\n\t#overrideOptions(options)\n\t{\n\t\tconst {includeLink} = options;\n\n\t\toptions.includeLink = link =>\n\t\t{\n\t\t\tconst excludedReason = this.#getExcludedReason(link);\n\n\t\t\tif (excludedReason === undefined)\n\t\t\t{\n\t\t\t\treturn includeLink(link);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// Undocumented return value type\n\t\t\t\treturn excludedReason;\n\t\t\t}\n\t\t};\n\n\t\treturn options;\n\t}\n\n\n\n\tpause()\n\t{\n\t\tthis.#htmlUrlChecker.pause();\n\t\tthis.#siteUrlQueue.pause();\n\t\treturn this;\n\t}\n\n\n\n\t#reset()\n\t{\n\t\tthis.#currentAuth = null;\n\t\tthis.#currentCustomData = null;\n\t\tthis.#currentDone = null;\n\t\tthis.#currentPageError = null;\n\t\tthis.#currentRobotsTxt = null;\n\t\tthis.#currentSiteURL = null;\n\t\tthis.#sitePagesChecked.clear();\n\t}\n\n\n\n\tresume()\n\t{\n\t\tthis.#htmlUrlChecker.resume();\n\t\tthis.#siteUrlQueue.resume();\n\t\treturn this;\n\t}\n\n\n\n\t// Useless, but consistent with other classes\n\tget __cache()\n\t{\n\t\treturn this.#htmlUrlChecker.__cache;\n\t}\n}\n"],"mappings":"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"}