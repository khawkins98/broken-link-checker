{"version":3,"file":"checkLink.js","names":["reasons","_interopRequireWildcard","require","_fileProtocol","_httpProtocol","_isString","_interopRequireDefault","_Link","_matchURL","obj","__esModule","default","_getRequireWildcardCache","e","WeakMap","r","t","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","_default","link","auth","cache","options","Link","TypeError","excludedKeywords","includedKeywords","includeLink","rebasedURL","REBASED_URL","break","isFileScheme","isHTTPScheme","exclude","matchURL","href","length","filterResult","isString","checkFileLink","checkHTTPLink","exports","module"],"sources":["../../lib/internal/checkLink.js"],"sourcesContent":["import * as reasons from \"./reasons\";\nimport {checkLink as checkFileLink, isCompatibleScheme as isFileScheme} from \"./file-protocol\";\nimport {checkLink as checkHTTPLink, isCompatibleScheme as isHTTPScheme} from \"./http-protocol\";\nimport isString from \"is-string\";\nimport Link, {REBASED_URL} from \"./Link\";\nimport matchURL from \"./matchURL\";\n\n\n\n/**\n * Check a link's URL to see if it is broken or not.\n * @param {Link} link\n * @param {object} auth\n * @param {URLCache} cache\n * @param {object} options\n * @throws {TypeError} non-Link\n * @returns {Promise<Link>}\n */\nexport default async (link, auth, cache, options) =>\n{\n\tif (!(link instanceof Link))\n\t{\n\t\tthrow new TypeError(\"Invalid Link\");\n\t}\n\telse\n\t{\n\t\tconst {excludedKeywords, includedKeywords, includeLink} = options;\n\t\tconst rebasedURL = link.get(REBASED_URL);\n\n\t\tif (rebasedURL === null)\n\t\t{\n\t\t\tlink.break(\"BLC_INVALID\");\n\t\t\treturn link;\n\t\t}\n\t\telse if (!isFileScheme(rebasedURL) && !isHTTPScheme(rebasedURL))\n\t\t{\n\t\t\tlink.exclude(\"BLC_UNSUPPORTED\");\n\t\t\treturn link;\n\t\t}\n\t\telse if (matchURL(rebasedURL.href, excludedKeywords))\n\t\t{\n\t\t\tlink.exclude(\"BLC_KEYWORD\");\n\t\t\treturn link;\n\t\t}\n\t\telse if (includedKeywords.length>0 && !matchURL(rebasedURL.href, includedKeywords))\n\t\t{\n\t\t\tlink.exclude(\"BLC_KEYWORD\");\n\t\t\treturn link;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst filterResult = includeLink(link);\n\n\t\t\t// Undocumented support for strings (from `SiteChecker`)\n\t\t\tif (isString(filterResult) && filterResult in reasons)\n\t\t\t{\n\t\t\t\tlink.exclude(filterResult);\n\t\t\t\treturn link;\n\t\t\t}\n\t\t\telse if (!filterResult)\n\t\t\t{\n\t\t\t\tlink.exclude(\"BLC_CUSTOM\");\n\t\t\t\treturn link;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (isFileScheme(rebasedURL))\n\t\t\t\t{\n\t\t\t\t\treturn checkFileLink(link);\n\t\t\t\t}\n\t\t\t\telse if (isHTTPScheme(rebasedURL))\n\t\t\t\t{\n\t\t\t\t\treturn checkHTTPLink(link, auth, cache, options);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n};\n"],"mappings":"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"}